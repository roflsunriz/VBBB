# Changelog

All notable changes to VBBB will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [2.1.0] - 2026-02-27

### Added

- 遠隔検索機能を実装（スクレイピング）し、ローカル検索結果との統合表示に対応
- 自動再投稿機能を追加し、投稿失敗時の再試行導線を強化
- 投稿関連データ（Cookie/認証状態など）を一括クリアして復旧できる操作を追加
- 関連スレッド類似度の調整機能を追加し、UIからしきい値を変更可能に
- スレッド表示モード切替を追加（標準 / 階層 / 吹き出し）
  - ThreadView のアクションバーに3モード切替UIを追加
  - 表示モードを localStorage に保存し、再起動後も前回設定を復元
- BBSメニューURL設定を拡張し、取得元URLの複数登録・保存に対応
  - 設定画面（Cookie / UA 管理）に BBSメニューURL タブを追加
  - URLを複数行で登録でき、空行除去・重複排除を実施
- インライン動画の初期音量設定（%）を追加
- インライン動画再生後にフォーカス位置を復元する仕組みを追加
- NGルール管理モーダルで既存ルールの編集・更新機能を追加
  - ルール一覧に編集アクションを追加し、既存条件をフォームへ読み込み可能化
  - 文字列・数値・時間の各条件フォームを編集初期値に対応

### Changed

- BBSメニュー取得処理を複数URL統合対応に変更し、取得結果をカテゴリ/板単位でマージするよう改善
- BBSメニューURL入力値の正規化（trim・http/https判定・重複排除・無効時デフォルト復帰）を追加
- URLリンク化処理を改善し、正規化・句読点除去など実運用で崩れにくいリンク抽出へ更新
- レス/スレッドの差分計算ロジックを追加し、ステータスメッセージ表示を改善
- スレッド右クリックメニューの「巡回に追加」をトグル化し、状態に応じて追加/削除を切替
- ResItem からの NGワード追加導線を改善し、ルール作成操作を簡素化
- NGルール編集時の状態表示（編集中ハイライト、更新ボタン表示、新規追加へ戻る操作）を追加して操作性を改善

### Fixed

- 複雑な名前フォーマットでワッチョイ抽出が失敗するケースを修正
- インライン動画操作後にフォーカスが外れる問題を軽減

## [2.0.1] - 2026-02-26

### Changed

- レンダラー最適化: ResItem / CountBadge を React.memo 化し bodyHtml・コピーメニューを useMemo/useCallback でキャッシュ
- レンダラー最適化: ThreadList に @tanstack/react-virtual による仮想スクロールを導入
- レンダラー最適化: Zustand セレクタの安定化と ThreadView/ThreadList の検索・フィルタに useDeferredValue を適用
- メインプロセス最適化: file-io.ts の同期 I/O を node:fs/promises に置換
- メインプロセス最適化: 起動時データ読み込み（閲覧履歴・Cookie・巡回リスト・プロキシ設定・プラグイン）を Promise.all で並列化
- メインプロセス最適化: HTTP クライアントに keepAlive Agent を導入し gunzipSync を非同期化
- メインプロセス最適化: dat-replace の while+replace ループを replaceAll に変更
- メインプロセス最適化: ローカル検索を非同期 I/O に切り替え、複数ボード検索を並列化
- メインプロセス最適化: subject.txt の条件付き GET（If-Modified-Since）を実装
- キャッシュ最適化: パース済み DAT の LRU メモリキャッシュを導入しタブ切り替え時の再パースを回避
- 起動最適化: Electron 起動フローの同期 I/O を排除し起動時間計測ログを追加

## [2.0.0] - 2026-02-25

### Added

- NG機能を大幅に強化（Siki準拠の高度なフィルタリング）
  - 文字列条件: 単純比較・正規表現・正規表現(大文字小文字無視)・あいまい検索に対応
  - 数値条件: ID数・被返信数・レス番号・行数・文字数・スレッドレス数などを eq/gte/lte/lt/gt/between で比較
  - 時間条件: 投稿曜日・投稿時間帯・相対時間・投稿日時範囲に対応
  - フィールド別照合: 名前・本文・メール・ID・トリップ・ﾜｯﾁｮｲ・IP・BE・URL・スレッドタイトルを個別指定可能
  - 全条件に否定(negate)オプションを追加
  - NGルール保存形式を NGword.txt からJSON形式 (ng-rules.json) に移行（旧形式からの自動マイグレーション付き）
  - NGエディタUIを文字列/数値/時間の3タブ構成にリニューアル
- お気に入り整理機能を実装
  - フォルダ作成・水平線(セパレータ)追加
  - ドラッグ＆ドロップによる並べ替え（before/after/inside対応）
  - 右クリックメニューの「フォルダに移動」サブメニュー
- スレッドタブ右クリックメニューに「外部ブラウザで開く」を追加
- 巡回タイマーのON/OFF状態をツールバーとパネルに視覚的に表示

### Changed

- 次スレ作成支援ボタンの表示条件（950レス以上）を撤廃し、常時表示に変更
- スレッド一覧の★クリック動作をお気に入り追加からトグル（追加/削除）に変更
- スレッドタブのアクションボタン群をタブバーとタイトルの間に移動し、常時表示に変更
- 巡回完了後に該当する板・スレッドを自動でリフレッシュするよう改善

### Fixed

- 巡回タイマーが起動しない問題を修正
- お気に入りフォルダ作成ボタンが反応しない問題を修正（Electron の window.prompt() 非対応をインライン入力に置換）

## [1.6.2] - 2026-02-25

### Changed

- ホバーポップアップの閉じるまでの時間を延長し、プレビューのじっくり閲覧・スクロール操作を改善
  - 名前別書き込みバッジ・ID別書き込みバッジのトリガー離脱遅延を 150ms → 500ms に拡大
  - ポップアップにマウスが入った際にクローズタイマーをキャンセルする仕組みを追加
  - ポップアップ離脱時の即時クローズを 300ms 遅延に変更（再入時キャンセル可能）
  - `+N` 返信ポップアップおよびアンカーリンクの子ポップアップ離脱遅延を 200ms → 400ms に拡大

## [1.6.1] - 2026-02-25

### Added

- 次スレ立て支援機能を実装
  - 現スレの >>1 をベースに次スレ用テンプレートを自動生成（タイトル番号+1、前スレURL置換、VIPQ2 `!extend` コマンド2行追加、`VIPQ2_EXTDAT` 除去）
  - レス数950以上のスレッドでツールバーに「次スレを立てる」ボタンを表示
  - 1000レス超過時の次スレバナーで次スレが見つからない場合に「次スレを立てる」ボタンを表示
  - DAT落ちスレッドに「次スレを立てる」ボタン付きバナーを表示
  - 新規スレッド作成エディタにテンプレートの初期値（タイトル・本文）を自動入力

## [1.6.0] - 2026-02-25

### Added

- `+N` 返信ポップアップの返信ツリー自動展開機能を実装
  - BFS（幅優先探索）で返信の連鎖（デイジーチェーン）や分岐を再帰的に収集し、1つのポップアップ内にフラット表示
  - 深さ1のみの制限を撤廃し、任意の深さの返信ツリーに対応（最大10件表示、超過時は「他にも返信があります」を表示）
- ポップアップ内の `>>N` アンカーリンクをクリッカブルに変換し、ホバーでネストされた子ポップアップを表示（最大深さ10段）
- ポップアップ内の外部URLクリックでブラウザで開く機能を追加
- CountBadge・ResItem コンポーネントにホバーインタラクション機能を追加
- スレッド内検索機能を追加

### Changed

- CI/リリースワークフローの実行環境を Ubuntu に変更

## [1.5.0] - 2026-02-23

### Added

- フォーム形式の DSL エディタモーダルを新設（ツールメニュー「DSLエディタ」/ Ctrl+Shift+D）
  - グローバル設定（SCHEDULE / COUNTDOWN）とPOSTブロックをフォームで入力し、.vbbs ソースをリアルタイム生成
  - 既存 .vbbs ファイルの読み込み・編集、名前を付けて保存、クリップボードコピーに対応
  - 投稿ブロックの動的追加・削除・折りたたみ
- DSL ソース生成ユーティリティ `generateDslSource` を追加（`parseDslScript` の逆操作）
- DSL ファイル保存用 IPC チャンネル `dsl:save-file` を追加
- ツールバーに DSL エディタボタンを追加
- `bun test` 向けに `bunfig.toml` と happy-dom グローバル登録を導入し、Bun 内蔵テストランナーでも全テスト合格するよう整備

### Changed

- プログラマティック書き込み欄の DSL タブからテキストエリアを廃止し、ファイル読み込み＋実行のみに簡素化
- ルート `tsconfig.json` に `@shared` / `@renderer` パスエイリアスを追加（bun test でのモジュール解決対応）
- `browsing-history` テストから `vi.setSystemTime` 依存を除去し、bun test 互換に改善

## [1.4.0] - 2026-02-23

### Added

- スレッド新規作成機能を実装（Slevo の ThreadCreatePostDialogExecutor を参考に移植）
  - スレッド一覧ヘッダーの「✏️+」ボタンから `NewThreadEditor` パネルを開いて板にスレッドを立てられる
  - タイトル（subject）・名前・メール・本文を入力して Ctrl+Enter または「スレッドを立てる」ボタンで送信
  - 作成成功後はスレッド一覧を自動リフレッシュし、新スレを自動で開く
- 次スレ自動移動機能を実装（5ch 閲覧ソフト標準的なシリーズ番号インクリメント方式）
  - スレッドが 950 レス以上でツールバーに「次スレ」ボタンが出現（手動検索）
  - スレッドが 1000 レス到達時に自動検索が走り、コンテンツ上部にバナーを表示
  - 次スレ検出アルゴリズム: タイトル最右端の数字を +1 してプレフィックス類似度で照合
  - 次スレが見つかった場合は「開く」ボタンでワンクリック移動、見つからない場合は「再検索」可能
- スレッドタブ間の前後移動機能を追加（Slevo の SwitchToNextTab / SwitchToPreviousTab に相当）
  - ThreadView のアクションバーに「‹」「›」ボタンを追加
  - `Alt+[` / `Alt+]` キーボードショートカットで前後のスレッドタブへ移動

### Changed

- `PostParams` 型に `subject?: string` フィールドを追加（新規スレッド作成時のスレッドタイトル）
- `PostParamsSchema` (Zod) を拡張し、`threadId` 空文字列時に `subject` を必須バリデーション
- `buildPostBody()` を新規スレッド作成モード対応に修正（`key` 省略・`subject` 追加・submit 文字列切替）

## [1.3.1] - 2026-02-22

### Added

- electron-updater を統合し、GitHub Releases を使った自動アップデート機能を実装（終了時にサイレントインストール対応）
- バンドル分析・可視化ツールを追加（rollup-plugin-visualizer による stats.html 生成）
- 複数コンポーネントのレイジーローディングを実装し、初回読み込みパフォーマンスを向上

### Changed

- electron-builder の設定を強化（最大圧縮・不要な WebGPU DLL の削除によるアプリサイズ削減）
- GitHub Actions のリリースワークフローを改善（CHANGELOG.md からリリースノートを自動抽出・ドラフトなし自動リリース）
- IPC ハンドラーのアップデート確認プロセスを簡略化
- package.json の依存関係を整理（@mdi/js、@tanstack/react-virtual、dompurify を追加）

## [1.3.0] - 2026-02-22

### Added

- コンテキストメニューの表示位置を改善する ContextMenuContainer コンポーネントを追加
- 画像の一括保存機能を追加（保存先フォルダをユーザーが選択可能）

### Changed

- IPC ハンドラー登録を最適化し、コンポーネントの遅延ロードを導入してパフォーマンスを向上

## [1.2.1] - 2026-02-21

### Added

- アプリ内アップデート確認機能を追加（GitHub Releases と連携したダイアログ表示）
- アプリメニューに GitHub リポジトリへのリンクを追加

### Fixed

- ThreadView のスクロール復元ロジックを改善

## [1.2.0] - 2026-02-20

### Added

- プログラマティック書き込み欄に DSL（ドメイン固有言語）サポートを導入し、構造化された書き込み指示の記述が可能に
- ThreadView にレスポンス ID の表示を追加
- DAT 落ちスレッドのハンドリング機能を実装（dat サービス・JBBS サービス・UI）

## [1.1.2] - 2026-02-19

### Added

- スレッド表示のスクロール復元に新規レスポンス追跡を追加し、正確な位置復元を強化
- dateTime フィールドへの IP ベース識別子抽出に対応

### Changed

- 投稿時の文字エンコード処理を強化（マルチバイト文字の互換性向上）

## [1.1.1] - 2026-02-18

### Fixed

- 投稿直後に自分の投稿ハイライトが適用されないバグを修正（`post:save-history` 保存完了後に `loadPostHistory` でストアを更新するよう変更）

## [1.1.0] - 2026-02-18

### Added

- 検索入力欄に検索履歴機能を追加（SearchInputWithHistory コンポーネント）。板ツリー・お気に入り・履歴・検索・スレッド一覧の各検索欄で履歴を localStorage に永続化し、過去の検索キーワードを候補表示から選択可能
- タブ切り替え時に直前のアクティブタブのスクロール位置を保存し、再訪時に復元する機能を追加

## [1.0.3] - 2026-02-18

### Added

- スレッド一覧の検索キーワード・並び替えを板タブごとに独立化（タブを切り替えても検索/ソート状態を保持）
- 書き込み欄・分析欄・プログラマティック書き込み欄をスレッドタブごとに独立化（NG欄は共通のまま維持）
- 返信を受けたレスのレス番前に `+N` バッジを表示し、マウスホバーで返信内容をポップアップ表示

## [1.0.2] - 2026-02-18

### Added

- 画像プレビューモーダル（ImageModal）にページ URL を外部ブラウザで開くリンクを追加（`pageUrl` prop 経由）
- ImageThumbnail から元 URL を ImageModal へ渡すよう対応し、ユーザーナビゲーションを改善

### Fixed

- フィルター適用・解除時にスクロール位置を保持するよう改善（ThreadView）
- フィルター適用中の仮想スクロール描画の安定性向上（アイテムキーのユニーク化）

## [1.0.1] - 2026-02-18

### Fixed

- 仮想スクロール導入後、画像プレビューモーダルがウィンドウ全体ではなくレス行の高さ範囲にのみ表示されていたバグを修正（`createPortal` で `document.body` 直下にレンダリングするよう変更）

## [1.0.0] - 2026-02-18

### Added

- 2ch/5ch 系掲示板の板一覧・スレッド一覧・スレッド表示
- DAT 形式の読み込み・差分取得
- 書き込み機能（2ch/5ch, JBBS, まちBBS）
- タブ管理・タブ永続化
- お気に入り管理
- 閲覧履歴・書き込み履歴
- NGフィルタ（あぼーん機能）
- こてはん管理
- キーワードローカル検索・リモート検索
- 板・スレッドのラウンドリスト管理
- プロキシ設定（HTTP/HTTPS）
- 画像プレビュー
- BE 認証・Uplift 認証サポート
- 外部プラグイン対応（JBBS, まちBBS）
- Windows 10/11 x64 用 NSIS インストーラー
- ライセンスを MIT に変更

[2.0.0]: https://github.com/roflsunriz/VBBB/compare/v1.6.2...v2.0.0
[1.6.2]: https://github.com/roflsunriz/VBBB/compare/v1.6.1...v1.6.2
[1.6.1]: https://github.com/roflsunriz/VBBB/compare/v1.6.0...v1.6.1
[1.6.0]: https://github.com/roflsunriz/VBBB/compare/v1.5.0...v1.6.0
[1.5.0]: https://github.com/roflsunriz/VBBB/compare/v1.4.0...v1.5.0
[1.4.0]: https://github.com/roflsunriz/VBBB/compare/v1.3.1...v1.4.0
[1.3.1]: https://github.com/roflsunriz/VBBB/compare/v1.3.0...v1.3.1
[1.3.0]: https://github.com/roflsunriz/VBBB/compare/v1.2.1...v1.3.0
[1.2.1]: https://github.com/roflsunriz/VBBB/compare/v1.2.0...v1.2.1
[1.2.0]: https://github.com/roflsunriz/VBBB/compare/v1.1.2...v1.2.0
[1.1.2]: https://github.com/roflsunriz/VBBB/compare/v1.1.1...v1.1.2
[1.1.1]: https://github.com/roflsunriz/VBBB/compare/v1.1.0...v1.1.1
[1.1.0]: https://github.com/roflsunriz/VBBB/compare/v1.0.3...v1.1.0
[1.0.3]: https://github.com/roflsunriz/VBBB/compare/v1.0.2...v1.0.3
[1.0.2]: https://github.com/roflsunriz/VBBB/compare/v1.0.1...v1.0.2
[1.0.1]: https://github.com/roflsunriz/VBBB/compare/v1.0.0...v1.0.1
[1.0.0]: https://github.com/roflsunriz/VBBB/releases/tag/v1.0.0
